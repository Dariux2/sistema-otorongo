<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes - Centro Oftalmológico El Otorongo</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard-page">
    <!-- Header del Dashboard -->
    <header class="dashboard-header-main">
        <div class="container">
            <div class="dashboard-brand">
                <i class="fas fa-eye"></i>
                <h1>Centro Oftalmológico El Otorongo</h1>
            </div>
            
            <div class="dashboard-user-info">
                <div class="user-welcome">
                    <span class="user-greeting">Bienvenido,</span>
                    <span class="user-name" id="userName">Usuario</span>
                    <span class="user-role" id="userRole">Rol</span>
                </div>
                <div class="user-actions">
                    <button class="btn-notification" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </button>
                    <button class="btn-profile" onclick="showProfile()">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-logout" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Salir</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navegación Principal -->
    <nav class="dashboard-nav">
        <div class="container">
            <ul class="nav-menu" id="dashboardMenu">
                <!-- El menú se carga dinámicamente según el rol -->
            </ul>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="dashboard-main">
        <div class="container">
            <!-- Header de la página -->
            <div class="page-header">
                <div class="page-title">
                    <h2><i class="fas fa-chart-bar"></i> Reportes y Estadísticas</h2>
                    <p>Análisis detallado del desempeño del centro médico</p>
                </div>
                <div class="page-actions">
                    <select id="reportPeriod" onchange="updateReports()">
                        <option value="week">Última Semana</option>
                        <option value="month" selected>Último Mes</option>
                        <option value="quarter">Último Trimestre</option>
                        <option value="year">Último Año</option>
                    </select>
                    <button class="btn-primary" onclick="exportReport()">
                        <i class="fas fa-file-export"></i> Exportar Reporte
                    </button>
                    <button class="btn-secondary" onclick="printReport()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>

            <!-- Estadísticas Generales -->
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalPatients">0</div>
                        <div class="stat-label">Total Pacientes</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="patientsTrend">0%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalAppointments">0</div>
                        <div class="stat-label">Citas Realizadas</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="appointmentsTrend">0%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalRevenue">S/. 0.00</div>
                        <div class="stat-label">Ingresos Totales</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="revenueTrend">0%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="satisfactionRate">0%</div>
                        <div class="stat-label">Satisfacción</div>
                        <div class="stat-trend positive">
                            <i class="fas fa-arrow-up"></i>
                            <span id="satisfactionTrend">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráficos y Reportes -->
            <div class="reports-layout">
                <!-- Gráfico de Citas por Mes -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Citas por Mes</h3>
                        <button class="btn-icon" onclick="refreshChart('appointments')">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="appointmentsChart"></canvas>
                    </div>
                </div>

                <!-- Gráfico de Ingresos -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Ingresos Mensuales</h3>
                        <button class="btn-icon" onclick="refreshChart('revenue')">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Distribución de Servicios -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-pie"></i> Servicios Más Solicitados</h3>
                        <button class="btn-icon" onclick="refreshChart('services')">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="servicesChart"></canvas>
                    </div>
                </div>

                <!-- Estado de Citas -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-donut"></i> Estado de Citas</h3>
                        <button class="btn-icon" onclick="refreshChart('status')">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tablas de Reportes Detallados -->
            <div class="detailed-reports">
                <!-- Top Pacientes -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-star"></i> Pacientes Frecuentes</h3>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Paciente</th>
                                    <th>Visitas</th>
                                    <th>Última Cita</th>
                                    <th>Total Gastado</th>
                                </tr>
                            </thead>
                            <tbody id="topPatientsTable">
                                <!-- Se carga dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Servicios Populares -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-trophy"></i> Servicios Más Rentables</h3>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Servicio</th>
                                    <th>Cantidad</th>
                                    <th>Ingresos</th>
                                    <th>Promedio</th>
                                </tr>
                            </thead>
                            <tbody id="topServicesTable">
                                <!-- Se carga dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Resumen Ejecutivo -->
            <div class="card executive-summary">
                <div class="card-header">
                    <h3><i class="fas fa-file-alt"></i> Resumen Ejecutivo</h3>
                </div>
                <div class="summary-content" id="executiveSummary">
                    <!-- Se carga dinámicamente -->
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    <script>
        // Variables globales
        let currentUser = null;
        let patients = [];
        let appointments = [];
        let invoices = [];
        let charts = {};

        // Inicializar página
        document.addEventListener('DOMContentLoaded', function() {
            initializeReportsPage();
        });

        function initializeReportsPage() {
            if (!checkAuthentication()) return;
            loadUserData();
            setupRoleBasedMenu();
            loadData();
            generateReports();
            createCharts();
        }

        function checkAuthentication() {
            const savedUser = localStorage.getItem('otorongo_current_user');
            if (!savedUser) {
                showNotification('Sesión expirada. Redirigiendo al login...', 'warning');
                setTimeout(() => window.location.href = 'login.html', 2000);
                return false;
            }
            currentUser = JSON.parse(savedUser);
            return true;
        }

        function loadUserData() {
            if (!currentUser) return;
            document.getElementById('userName').textContent = currentUser.name || currentUser.username;
            document.getElementById('userRole').textContent = getRoleDisplayName(currentUser.role);
        }

        function getRoleDisplayName(role) {
            const roleNames = {
                'administrador': 'Administrador',
                'medico': 'Médico',
                'recepcionista': 'Recepcionista'
            };
            return roleNames[role] || role;
        }

        function setupRoleBasedMenu() {
            const menuContainer = document.getElementById('dashboardMenu');
            const menus = {
                'administrador': [
                    { icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'dashboard' },
                    { icon: 'fas fa-users', text: 'Pacientes', page: 'pacientes' },
                    { icon: 'fas fa-calendar-alt', text: 'Citas', page: 'citas' },
                    { icon: 'fas fa-file-invoice-dollar', text: 'Facturación', page: 'facturacion' },
                    { icon: 'fas fa-chart-bar', text: 'Reportes', page: 'reportes', active: true }
                ],
                'medico': [
                    { icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'dashboard' },
                    { icon: 'fas fa-users', text: 'Mis Pacientes', page: 'pacientes' },
                    { icon: 'fas fa-calendar-alt', text: 'Mis Citas', page: 'citas' },
                    { icon: 'fas fa-chart-line', text: 'Mis Reportes', page: 'reportes', active: true }
                ],
                'recepcionista': [
                    { icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'dashboard' },
                    { icon: 'fas fa-users', text: 'Pacientes', page: 'pacientes' },
                    { icon: 'fas fa-calendar-alt', text: 'Citas', page: 'citas' },
                    { icon: 'fas fa-file-invoice', text: 'Facturación', page: 'facturacion' }
                ]
            };

            const userMenu = menus[currentUser.role] || menus['recepcionista'];
            
            menuContainer.innerHTML = userMenu.map(item => `
                <li>
                    <a href="${item.page}.html" class="nav-item ${item.active ? 'active' : ''}">
                        <i class="${item.icon}"></i>
                        <span>${item.text}</span>
                    </a>
                </li>
            `).join('');
        }

        function loadData() {
            patients = OtorongoSystem.getPatients();
            appointments = OtorongoSystem.getAppointments();
            invoices = OtorongoSystem.getInvoices();
        }

        function generateReports() {
            updateStatistics();
            generateTopPatients();
            generateTopServices();
            generateExecutiveSummary();
        }

        function updateStatistics() {
            // Total de pacientes
            document.getElementById('totalPatients').textContent = patients.length;
            document.getElementById('patientsTrend').textContent = '12%';

            // Total de citas completadas
            const completedAppointments = appointments.filter(apt => apt.estado === 'completada').length;
            document.getElementById('totalAppointments').textContent = completedAppointments;
            document.getElementById('appointmentsTrend').textContent = '8%';

            // Ingresos totales
            const totalRevenue = invoices
                .filter(inv => inv.estado === 'pagada')
                .reduce((sum, inv) => sum + inv.total, 0);
            document.getElementById('totalRevenue').textContent = `S/. ${totalRevenue.toFixed(2)}`;
            document.getElementById('revenueTrend').textContent = '15%';

            // Tasa de satisfacción (simulada)
            const satisfactionRate = 95;
            document.getElementById('satisfactionRate').textContent = `${satisfactionRate}%`;
            document.getElementById('satisfactionTrend').textContent = '3%';
        }

        function createCharts() {
            createAppointmentsChart();
            createRevenueChart();
            createServicesChart();
            createStatusChart();
        }

        function createAppointmentsChart() {
            const ctx = document.getElementById('appointmentsChart');
            if (!ctx) return;

            // Datos simulados para los últimos 6 meses
            const months = ['Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const data = [45, 52, 48, 65, 58, 72];

            // Crear gráfico simple con barras ASCII
            const container = ctx.parentElement;
            container.innerHTML = `
                <div class="simple-chart">
                    ${months.map((month, i) => `
                        <div class="chart-bar-group">
                            <div class="chart-bar" style="height: ${(data[i] / Math.max(...data)) * 200}px">
                                <span class="bar-value">${data[i]}</span>
                            </div>
                            <div class="chart-label">${month}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;

            const months = ['Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            const data = [3500, 4200, 3800, 5100, 4600, 5800];

            const container = ctx.parentElement;
            container.innerHTML = `
                <div class="simple-chart">
                    ${months.map((month, i) => `
                        <div class="chart-bar-group">
                            <div class="chart-bar revenue" style="height: ${(data[i] / Math.max(...data)) * 200}px">
                                <span class="bar-value">S/. ${data[i]}</span>
                            </div>
                            <div class="chart-label">${month}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function createServicesChart() {
            const ctx = document.getElementById('servicesChart');
            if (!ctx) return;

            const services = [
                { name: 'Consulta General', value: 35, color: '#2c5aa0' },
                { name: 'Cirugía Cataratas', value: 25, color: '#4a90e2' },
                { name: 'Control', value: 20, color: '#00a8cc' },
                { name: 'Refracción', value: 15, color: '#28a745' },
                { name: 'Otros', value: 5, color: '#ffc107' }
            ];

            const total = services.reduce((sum, s) => sum + s.value, 0);

            const container = ctx.parentElement;
            container.innerHTML = `
                <div class="pie-chart">
                    <div class="pie-chart-legend">
                        ${services.map(s => `
                            <div class="legend-item">
                                <span class="legend-color" style="background: ${s.color}"></span>
                                <span class="legend-text">${s.name}</span>
                                <span class="legend-value">${s.value}%</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="pie-chart-visual">
                        ${services.map(s => `
                            <div class="pie-segment" style="width: ${s.value}%; background: ${s.color}">
                                ${s.value}%
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function createStatusChart() {
            const ctx = document.getElementById('statusChart');
            if (!ctx) return;

            const programadas = appointments.filter(apt => apt.estado === 'programada').length;
            const completadas = appointments.filter(apt => apt.estado === 'completada').length;
            const canceladas = appointments.filter(apt => apt.estado === 'cancelada').length;
            const total = appointments.length || 1;

            const data = [
                { name: 'Programadas', value: Math.round((programadas / total) * 100), color: '#ffc107' },
                { name: 'Completadas', value: Math.round((completadas / total) * 100), color: '#28a745' },
                { name: 'Canceladas', value: Math.round((canceladas / total) * 100), color: '#dc3545' }
            ];

            const container = ctx.parentElement;
            container.innerHTML = `
                <div class="donut-chart">
                    ${data.map(d => `
                        <div class="donut-item">
                            <div class="donut-circle" style="background: ${d.color}">
                                <span>${d.value}%</span>
                            </div>
                            <div class="donut-label">${d.name}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateTopPatients() {
            const patientVisits = {};
            
            appointments.forEach(apt => {
                if (!patientVisits[apt.pacienteId]) {
                    patientVisits[apt.pacienteId] = {
                        count: 0,
                        lastVisit: apt.fecha,
                        total: 0
                    };
                }
                patientVisits[apt.pacienteId].count++;
                if (apt.fecha > patientVisits[apt.pacienteId].lastVisit) {
                    patientVisits[apt.pacienteId].lastVisit = apt.fecha;
                }
            });

            invoices.forEach(inv => {
                if (patientVisits[inv.pacienteId]) {
                    patientVisits[inv.pacienteId].total += inv.total;
                }
            });

            const topPatients = Object.entries(patientVisits)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 5);

            const tbody = document.getElementById('topPatientsTable');
            tbody.innerHTML = topPatients.map(([patientId, data]) => {
                const patient = patients.find(p => p.id === patientId);
                const patientName = patient ? `${patient.nombres} ${patient.apellidos}` : 'N/A';
                
                return `
                    <tr>
                        <td>${patientName}</td>
                        <td><span class="badge info">${data.count}</span></td>
                        <td>${OtorongoSystem.formatDate(data.lastVisit)}</td>
                        <td><strong>S/. ${data.total.toFixed(2)}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        function generateTopServices() {
            const serviceStats = {};
            
            invoices.forEach(inv => {
                inv.servicios.forEach(s => {
                    if (!serviceStats[s.descripcion]) {
                        serviceStats[s.descripcion] = {
                            count: 0,
                            revenue: 0
                        };
                    }
                    serviceStats[s.descripcion].count += s.cantidad;
                    serviceStats[s.descripcion].revenue += s.cantidad * s.precio;
                });
            });

            const topServices = Object.entries(serviceStats)
                .sort((a, b) => b[1].revenue - a[1].revenue)
                .slice(0, 5);

            const tbody = document.getElementById('topServicesTable');
            tbody.innerHTML = topServices.map(([service, data]) => {
                const average = data.revenue / data.count;
                
                return `
                    <tr>
                        <td>${service}</td>
                        <td><span class="badge success">${data.count}</span></td>
                        <td><strong>S/. ${data.revenue.toFixed(2)}</strong></td>
                        <td>S/. ${average.toFixed(2)}</td>
                    </tr>
                `;
            }).join('');
        }

        function generateExecutiveSummary() {
            const totalRevenue = invoices
                .filter(inv => inv.estado === 'pagada')
                .reduce((sum, inv) => sum + inv.total, 0);
            
            const avgRevenue = totalRevenue / (invoices.length || 1);
            const completedAppointments = appointments.filter(apt => apt.estado === 'completada').length;
            const completionRate = ((completedAppointments / (appointments.length || 1)) * 100).toFixed(1);

            const summary = document.getElementById('executiveSummary');
            summary.innerHTML = `
                <div class="summary-grid">
                    <div class="summary-item">
                        <h4>Desempeño General</h4>
                        <p>El centro ha atendido a <strong>${patients.length} pacientes</strong> con un total de <strong>${appointments.length} citas</strong> programadas. La tasa de completación de citas es del <strong>${completionRate}%</strong>, lo que indica un excelente nivel de cumplimiento.</p>
                    </div>
                    
                    <div class="summary-item">
                        <h4>Ingresos</h4>
                        <p>Los ingresos totales ascienden a <strong>S/. ${totalRevenue.toFixed(2)}</strong>, con un promedio de <strong>S/. ${avgRevenue.toFixed(2)}</strong> por factura. Se observa una tendencia positiva en los últimos meses.</p>
                    </div>
                    
                    <div class="summary-item">
                        <h4>Servicios Destacados</h4>
                        <p>Los servicios más solicitados son las consultas generales y cirugías de cataratas, representando el 60% del total de servicios prestados.</p>
                    </div>
                    
                    <div class="summary-item">
                        <h4>Recomendaciones</h4>
                        <ul>
                            <li>Mantener el alto nivel de satisfacción del paciente</li>
                            <li>Considerar ampliar horarios para servicios populares</li>
                            <li>Implementar programa de fidelización para pacientes frecuentes</li>
                            <li>Optimizar tiempos de espera en consultas</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function updateReports() {
            showNotification('Actualizando reportes...', 'info');
            setTimeout(() => {
                generateReports();
                createCharts();
                showNotification('Reportes actualizados', 'success');
            }, 1000);
        }

        function refreshChart(chartType) {
            showNotification(`Actualizando gráfico de ${chartType}...`, 'info');
            setTimeout(() => {
                createCharts();
                showNotification('Gráfico actualizado', 'success');
            }, 500);
        }

        function exportReport() {
            showNotification('Exportando reporte...', 'info');
            
            let csv = 'REPORTE GENERAL - CENTRO OFTALMOLÓGICO EL OTORONGO\n\n';
            csv += `Fecha de Generación: ${new Date().toLocaleDateString('es-ES')}\n\n`;
            
            csv += 'ESTADÍSTICAS GENERALES\n';
            csv += `Total Pacientes,${patients.length}\n`;
            csv += `Total Citas,${appointments.length}\n`;
            csv += `Citas Completadas,${appointments.filter(apt => apt.estado === 'completada').length}\n`;
            csv += `Ingresos Totales,${invoices.filter(inv => inv.estado === 'pagada').reduce((sum, inv) => sum + inv.total, 0).toFixed(2)}\n\n`;
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reporte_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Reporte exportado correctamente', 'success');
        }

        function printReport() {
            window.print();
        }

        function showNotifications() {
            showNotification('No hay notificaciones nuevas', 'info');
        }

        function showProfile() {
            showNotification('Función de perfil en desarrollo', 'info');
        }

        function logout() {
            if (confirm('¿Está seguro que desea cerrar sesión?')) {
                localStorage.removeItem('otorongo_current_user');
                localStorage.removeItem('otorongo_login_time');
                showNotification('Sesión cerrada correctamente', 'success');
                setTimeout(() => window.location.href = 'login.html', 1500);
            }
        }
    </script>

    <style>
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-200);
        }

        .page-title h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-title p {
            color: var(--gray-600);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .page-actions select {
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            background: var(--white);
            font-weight: 500;
            cursor: pointer;
        }

        .reports-layout {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-container {
            padding: 2rem;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .simple-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            width: 100%;
            height: 250px;
            gap: 1rem;
        }

        .chart-bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-bar {
            width: 100%;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            position: relative;
            transition: var(--transition);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 0.5rem;
        }

        .chart-bar:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(44, 90, 160, 0.3);
        }

        .chart-bar.revenue {
            background: linear-gradient(180deg, var(--success-color), #1e7e34);
        }

        .bar-value {
            color: var(--white);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .chart-label {
            font-size: 0.85rem;
            color: var(--gray-600);
            text-align: center;
            font-weight: 500;
        }

        .pie-chart {
            width: 100%;
        }

        .pie-chart-legend {
            margin-bottom: 1.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-text {
            flex: 1;
            font-weight: 500;
        }

        .legend-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        .pie-chart-visual {
            display: flex;
            height: 40px;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .pie-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .pie-segment:hover {
            opacity: 0.8;
        }

        .donut-chart {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
        }

        .donut-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .donut-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .donut-circle:hover {
            transform: scale(1.1);
        }

        .donut-label {
            font-weight: 600;
            color: var(--gray-700);
        }

        .detailed-reports {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin: 2rem 0;
        }

        .executive-summary {
            margin-top: 2rem;
        }

        .summary-content {
            padding: 2rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }

        .summary-item {
            background: var(--gray-50);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .summary-item h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .summary-item p {
            color: var(--gray-700);
            line-height: 1.8;
        }

        .summary-item ul {
            list-style: none;
            padding-left: 0;
        }

        .summary-item li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: var(--gray-700);
        }

        .summary-item li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        @media print {
            .dashboard-header-main,
            .dashboard-nav,
            .page-actions,
            .btn-icon {
                display: none !important;
            }

            .page-header {
                border-bottom: 2px solid #000;
            }

            .card {
                page-break-inside: avoid;
            }
        }

        @media (max-width: 1024px) {
            .reports-layout {
                grid-template-columns: 1fr;
            }

            .detailed-reports {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .page-actions {
                flex-direction: column;
                width: 100%;
            }

            .page-actions select,
            .page-actions button {
                width: 100%;
            }

            .simple-chart {
                height: 200px;
            }

            .donut-chart {
                flex-direction: column;
            }

            .chart-label {
                font-size: 0.75rem;
            }
        }
    </style>
</body>
</html>
