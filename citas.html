<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Citas - Centro Oftalmológico El Otorongo</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard-page">
    <!-- Header del Dashboard -->
    <header class="dashboard-header-main">
        <div class="container">
            <div class="dashboard-brand">
                <i class="fas fa-eye"></i>
                <h1>Centro Oftalmológico El Otorongo</h1>
            </div>
            
            <div class="dashboard-user-info">
                <div class="user-welcome">
                    <span class="user-greeting">Bienvenido,</span>
                    <span class="user-name" id="userName">Usuario</span>
                    <span class="user-role" id="userRole">Rol</span>
                </div>
                <div class="user-actions">
                    <button class="btn-notification" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </button>
                    <button class="btn-profile" onclick="showProfile()">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-logout" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Salir</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navegación Principal -->
    <nav class="dashboard-nav">
        <div class="container">
            <ul class="nav-menu" id="dashboardMenu">
                <!-- El menú se carga dinámicamente según el rol -->
            </ul>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="dashboard-main">
        <div class="container">
            <!-- Header de la página -->
            <div class="page-header">
                <div class="page-title">
                    <h2><i class="fas fa-calendar-alt"></i> Gestión de Citas</h2>
                    <p>Programe y administre las citas médicas</p>
                </div>
                <div class="page-actions">
                    <button class="btn-primary" onclick="openModal('newAppointmentModal')">
                        <i class="fas fa-calendar-plus"></i> Nueva Cita
                    </button>
                    <button class="btn-secondary" onclick="refreshAppointments()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                </div>
            </div>

            <!-- Vista de Calendario y Lista -->
            <div class="appointments-layout">
                <!-- Calendario -->
                <div class="calendar-section">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-calendar"></i> Calendario de Citas</h3>
                            <div class="calendar-controls">
                                <button class="btn-icon" onclick="previousMonth()">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="currentMonthYear" class="current-month"></span>
                                <button class="btn-icon" onclick="nextMonth()">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="calendar-container">
                            <div class="calendar-weekdays">
                                <div class="weekday">Dom</div>
                                <div class="weekday">Lun</div>
                                <div class="weekday">Mar</div>
                                <div class="weekday">Mié</div>
                                <div class="weekday">Jue</div>
                                <div class="weekday">Vie</div>
                                <div class="weekday">Sáb</div>
                            </div>
                            <div class="calendar-days" id="calendarDays">
                                <!-- Los días se generan dinámicamente -->
                            </div>
                        </div>
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <span class="legend-color available"></span>
                                <span>Disponible</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color has-appointments"></span>
                                <span>Con citas</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color selected"></span>
                                <span>Seleccionado</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Citas -->
                <div class="appointments-list-section">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-list"></i> Citas del Día</h3>
                            <div class="filter-controls">
                                <select id="filterStatus" onchange="filterAppointments()">
                                    <option value="">Todos los estados</option>
                                    <option value="programada">Programada</option>
                                    <option value="completada">Completada</option>
                                    <option value="cancelada">Cancelada</option>
                                </select>
                            </div>
                        </div>
                        <div class="appointments-list" id="appointmentsList">
                            <!-- Las citas se cargan dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Nueva Cita -->
    <div id="newAppointmentModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-calendar-plus"></i> Nueva Cita
                </h3>
                <button class="modal-close" onclick="closeModal('newAppointmentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="newAppointmentForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="appointmentPatient">
                                <i class="fas fa-user"></i> Paciente *
                            </label>
                            <select id="appointmentPatient" name="pacienteId" required>
                                <option value="">Seleccione un paciente</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="appointmentDate">
                                <i class="fas fa-calendar"></i> Fecha *
                            </label>
                            <input type="date" id="appointmentDate" name="fecha" required>
                        </div>

                        <div class="form-group">
                            <label for="appointmentTime">
                                <i class="fas fa-clock"></i> Hora *
                            </label>
                            <select id="appointmentTime" name="hora" required>
                                <option value="">Seleccione una hora</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="appointmentDoctor">
                                <i class="fas fa-user-md"></i> Médico *
                            </label>
                            <select id="appointmentDoctor" name="medico" required>
                                <option value="">Seleccione un médico</option>
                                <option value="Dr. Carlos Mendoza">Dr. Carlos Mendoza</option>
                                <option value="Dra. Ana García">Dra. Ana García</option>
                                <option value="Dr. Luis Ramírez">Dr. Luis Ramírez</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="appointmentType">
                                <i class="fas fa-stethoscope"></i> Tipo de Consulta *
                            </label>
                            <select id="appointmentType" name="tipo" required>
                                <option value="">Seleccione el tipo</option>
                                <option value="Consulta General">Consulta General</option>
                                <option value="Control">Control</option>
                                <option value="Cirugía">Cirugía</option>
                                <option value="Emergencia">Emergencia</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="appointmentDuration">
                                <i class="fas fa-hourglass-half"></i> Duración
                            </label>
                            <select id="appointmentDuration" name="duracion">
                                <option value="30">30 minutos</option>
                                <option value="60" selected>60 minutos</option>
                                <option value="90">90 minutos</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="appointmentNotes">
                                <i class="fas fa-notes-medical"></i> Observaciones
                            </label>
                            <textarea id="appointmentNotes" name="observaciones" rows="3" placeholder="Motivo de la consulta u observaciones adicionales"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Agendar Cita
                        </button>
                        <button type="button" class="btn-secondary" onclick="closeModal('newAppointmentModal')">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Ver Cita -->
    <div id="viewAppointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-calendar-check"></i> Detalles de la Cita
                </h3>
                <button class="modal-close" onclick="closeModal('viewAppointmentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="appointmentDetails">
                    <!-- Los detalles se cargan dinámicamente -->
                </div>
                <div class="modal-actions">
                    <button class="btn-success" onclick="completeAppointment()">
                        <i class="fas fa-check"></i> Completar
                    </button>
                    <button class="btn-warning" onclick="rescheduleAppointment()">
                        <i class="fas fa-calendar-alt"></i> Reprogramar
                    </button>
                    <button class="btn-danger" onclick="cancelAppointment()">
                        <i class="fas fa-times-circle"></i> Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Variables globales
        let currentUser = null;
        let appointments = [];
        let patients = [];
        let currentDate = new Date();
        let selectedDate = new Date();
        let selectedAppointmentId = null;

        // Inicializar página
        document.addEventListener('DOMContentLoaded', function() {
            initializeAppointmentsPage();
        });

        function initializeAppointmentsPage() {
            if (!checkAuthentication()) return;
            loadUserData();
            setupRoleBasedMenu();
            loadPatients();
            loadAppointments();
            generateCalendar();
            setupForms();
            setMinDate();
            generateTimeSlots();
        }

        function checkAuthentication() {
            const savedUser = localStorage.getItem('otorongo_current_user');
            if (!savedUser) {
                showNotification('Sesión expirada. Redirigiendo al login...', 'warning');
                setTimeout(() => window.location.href = 'login.html', 2000);
                return false;
            }
            currentUser = JSON.parse(savedUser);
            return true;
        }

        function loadUserData() {
            if (!currentUser) return;
            document.getElementById('userName').textContent = currentUser.name || currentUser.username;
            document.getElementById('userRole').textContent = getRoleDisplayName(currentUser.role);
        }

        function getRoleDisplayName(role) {
            const roleNames = {
                'administrador': 'Administrador',
                'medico': 'Médico',
                'recepcionista': 'Recepcionista'
            };
            return roleNames[role] || role;
        }

        function setupRoleBasedMenu() {
            const menuContainer = document.getElementById('dashboardMenu');
            const menus = {
                'administrador': [
                    { icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'dashboard' },
                    { icon: 'fas fa-users', text: 'Pacientes', page: 'pacientes' },
                    { icon: 'fas fa-calendar-alt', text: 'Citas', page: 'citas', active: true },
                    { icon: 'fas fa-file-invoice-dollar', text: 'Facturación', page: 'facturacion' },
                    { icon: 'fas fa-chart-bar', text: 'Reportes', page: 'reportes' }
                ],
                'medico': [
                    { icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'dashboard' },
                    { icon: 'fas fa-users', text: 'Mis Pacientes', page: 'pacientes' },
                    { icon: 'fas fa-calendar-alt', text: 'Mis Citas', page: 'citas', active: true },
                    { icon: 'fas fa-notes-medical', text: 'Historiales', page: 'historiales' }
                ],
                'recepcionista': [
                    { icon: 'fas fa-tachometer-alt', text: 'Dashboard', page: 'dashboard' },
                    { icon: 'fas fa-users', text: 'Pacientes', page: 'pacientes' },
                    { icon: 'fas fa-calendar-alt', text: 'Citas', page: 'citas', active: true },
                    { icon: 'fas fa-file-invoice', text: 'Facturación', page: 'facturacion' }
                ]
            };

            const userMenu = menus[currentUser.role] || menus['recepcionista'];
            
            menuContainer.innerHTML = userMenu.map(item => `
                <li>
                    <a href="${item.page}.html" class="nav-item ${item.active ? 'active' : ''}">
                        <i class="${item.icon}"></i>
                        <span>${item.text}</span>
                    </a>
                </li>
            `).join('');
        }

        function loadPatients() {
            patients = OtorongoSystem.getPatients();
            const select = document.getElementById('appointmentPatient');
            select.innerHTML = '<option value="">Seleccione un paciente</option>' +
                patients.map(p => `<option value="${p.id}">${p.nombres} ${p.apellidos} - DNI: ${p.dni}</option>`).join('');
        }

        function loadAppointments() {
            appointments = OtorongoSystem.getAppointments();
            displayAppointmentsForDate(selectedDate);
            updateNotificationCount();
        }

        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').setAttribute('min', today);
        }

        function generateTimeSlots() {
            const select = document.getElementById('appointmentTime');
            const slots = [];
            
            for (let hour = 8; hour <= 18; hour++) {
                for (let min = 0; min < 60; min += 30) {
                    const time = `${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
                    slots.push(`<option value="${time}">${time}</option>`);
                }
            }
            
            select.innerHTML = '<option value="">Seleccione una hora</option>' + slots.join('');
        }

        function generateCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonthYear').textContent = 
                new Date(year, month).toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Días vacíos del mes anterior
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarDays.appendChild(emptyDay);
            }
            
            // Días del mes actual
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                const currentDateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dayAppointments = appointments.filter(apt => apt.fecha === currentDateStr);
                
                dayElement.className = 'calendar-day';
                dayElement.innerHTML = `
                    <span class="day-number">${day}</span>
                    ${dayAppointments.length > 0 ? `<span class="appointment-count">${dayAppointments.length}</span>` : ''}
                `;
                
                if (dayAppointments.length > 0) {
                    dayElement.classList.add('has-appointments');
                }
                
                const today = new Date();
                if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                if (year === selectedDate.getFullYear() && month === selectedDate.getMonth() && day === selectedDate.getDate()) {
                    dayElement.classList.add('selected');
                }
                
                dayElement.addEventListener('click', () => selectDate(year, month, day));
                calendarDays.appendChild(dayElement);
            }
        }

        function selectDate(year, month, day) {
            selectedDate = new Date(year, month, day);
            generateCalendar();
            displayAppointmentsForDate(selectedDate);
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        function displayAppointmentsForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            let dayAppointments = appointments.filter(apt => apt.fecha === dateStr);
            
            // Filtrar por estado si hay filtro activo
            const filterStatus = document.getElementById('filterStatus').value;
            if (filterStatus) {
                dayAppointments = dayAppointments.filter(apt => apt.estado === filterStatus);
            }
            
            // Filtrar por médico si es rol médico
            if (currentUser.role === 'medico') {
                dayAppointments = dayAppointments.filter(apt => apt.medico === currentUser.name);
            }
            
            const container = document.getElementById('appointmentsList');
            
            if (dayAppointments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>No hay citas para ${date.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                `;
                return;
            }
            
            dayAppointments.sort((a, b) => a.hora.localeCompare(b.hora));
            
            container.innerHTML = dayAppointments.map(apt => {
                const patient = patients.find(p => p.id === apt.pacienteId);
                const patientName = patient ? `${patient.nombres} ${patient.apellidos}` : 'Paciente no encontrado';
                
                return `
                    <div class="appointment-card ${apt.estado}" onclick="viewAppointmentDetails('${apt.id}')">
                        <div class="appointment-time">
                            <i class="fas fa-clock"></i>
                            <span>${apt.hora}</span>
                        </div>
                        <div class="appointment-info">
                            <h4>${patientName}</h4>
                            <p><i class="fas fa-user-md"></i> ${apt.medico}</p>
                            <p><i class="fas fa-stethoscope"></i> ${apt.tipo}</p>
                        </div>
                        <div class="appointment-status">
                            <span class="badge ${apt.estado}">${apt.estado}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function setupForms() {
            const form = document.getElementById('newAppointmentForm');
            form.addEventListener('submit', handleNewAppointment);
            
            // Verificar paciente preseleccionado
            const preselectedPatient = localStorage.getItem('preselected_patient');
            if (preselectedPatient) {
                document.getElementById('appointmentPatient').value = preselectedPatient;
                localStorage.removeItem('preselected_patient');
            }
        }

        function handleNewAppointment(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const appointmentData = {
                id: OtorongoSystem.generateId(),
                pacienteId: formData.get('pacienteId'),
                fecha: formData.get('fecha'),
                hora: formData.get('hora'),
                medico: formData.get('medico'),
                tipo: formData.get('tipo'),
                duracion: formData.get('duracion') || '60',
                observaciones: formData.get('observaciones') || '',
                estado: 'programada',
                fechaCreacion: new Date().toISOString()
            };
            
            // Verificar conflictos de horario
            const hasConflict = appointments.some(apt => 
                apt.fecha === appointmentData.fecha &&
                apt.hora === appointmentData.hora &&
                apt.medico === appointmentData.medico &&
                apt.estado !== 'cancelada'
            );
            
            if (hasConflict) {
                showNotification('Ya existe una cita programada para ese médico en ese horario', 'error');
                return;
            }
            
            appointments.push(appointmentData);
            OtorongoSystem.saveAppointments(appointments);
            
            loadAppointments();
            closeModal('newAppointmentModal');
            e.target.reset();
            
            showNotification('Cita agendada correctamente', 'success');
        }

        function viewAppointmentDetails(appointmentId) {
            const appointment = appointments.find(apt => apt.id === appointmentId);
            if (!appointment) return;
            
            selectedAppointmentId = appointmentId;
            const patient = patients.find(p => p.id === appointment.pacienteId);
            const patientName = patient ? `${patient.nombres} ${patient.apellidos}` : 'Paciente no encontrado';
            
            const detailsContainer = document.getElementById('appointmentDetails');
            detailsContainer.innerHTML = `
                <div class="appointment-detail-card">
                    <div class="detail-row">
                        <label><i class="fas fa-user"></i> Paciente:</label>
                        <span>${patientName}</span>
                    </div>
                    <div class="detail-row">
                        <label><i class="fas fa-calendar"></i> Fecha:</label>
                        <span>${OtorongoSystem.formatDate(appointment.fecha)}</span>
                    </div>
                    <div class="detail-row">
                        <label><i class="fas fa-clock"></i> Hora:</label>
                        <span>${appointment.hora}</span>
                    </div>
                    <div class="detail-row">
                        <label><i class="fas fa-user-md"></i> Médico:</label>
                        <span>${appointment.medico}</span>
                    </div>
                    <div class="detail-row">
                        <label><i class="fas fa-stethoscope"></i> Tipo:</label>
                        <span>${appointment.tipo}</span>
                    </div>
                    <div class="detail-row">
                        <label><i class="fas fa-hourglass-half"></i> Duración:</label>
                        <span>${appointment.duracion} minutos</span>
                    </div>
                    ${appointment.observaciones ? `
                        <div class="detail-row full-width">
                            <label><i class="fas fa-notes-medical"></i> Observaciones:</label>
                            <span>${appointment.observaciones}</span>
                        </div>
                    ` : ''}
                    <div class="detail-row">
                        <label><i class="fas fa-info-circle"></i> Estado:</label>
                        <span class="badge ${appointment.estado}">${appointment.estado}</span>
                    </div>
                </div>
            `;
            
            openModal('viewAppointmentModal');
        }

        function completeAppointment() {
            if (!selectedAppointmentId) return;
            
            const appointment = appointments.find(apt => apt.id === selectedAppointmentId);
            if (appointment) {
                appointment.estado = 'completada';
                OtorongoSystem.saveAppointments(appointments);
                loadAppointments();
                closeModal('viewAppointmentModal');
                showNotification('Cita marcada como completada', 'success');
            }
        }

        function rescheduleAppointment() {
            closeModal('viewAppointmentModal');
            showNotification('Función de reprogramar en desarrollo', 'info');
        }

        function cancelAppointment() {
            if (!selectedAppointmentId) return;
            
            if (confirm('¿Está seguro que desea cancelar esta cita?')) {
                const appointment = appointments.find(apt => apt.id === selectedAppointmentId);
                if (appointment) {
                    appointment.estado = 'cancelada';
                    OtorongoSystem.saveAppointments(appointments);
                    loadAppointments();
                    closeModal('viewAppointmentModal');
                    showNotification('Cita cancelada', 'warning');
                }
            }
        }

        function filterAppointments() {
            displayAppointmentsForDate(selectedDate);
        }

        function refreshAppointments() {
            loadAppointments();
            showNotification('Citas actualizadas', 'success');
        }

        function updateNotificationCount() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => 
                apt.fecha === today && apt.estado === 'programada'
            );
            document.getElementById('notificationCount').textContent = todayAppointments.length;
        }

        function showNotifications() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => 
                apt.fecha === today && apt.estado === 'programada'
            );
            
            if (todayAppointments.length === 0) {
                showNotification('No hay citas pendientes para hoy', 'info');
            } else {
                showNotification(`Tiene ${todayAppointments.length} cita(s) programada(s) para hoy`, 'info');
            }
        }

        function showProfile() {
            showNotification('Función de perfil en desarrollo', 'info');
        }

        function logout() {
            if (confirm('¿Está seguro que desea cerrar sesión?')) {
                localStorage.removeItem('otorongo_current_user');
                localStorage.removeItem('otorongo_login_time');
                showNotification('Sesión cerrada correctamente', 'success');
                setTimeout(() => window.location.href = 'login.html', 1500);
            }
        }
    </script>

    <style>
        .appointments-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .calendar-container {
            padding: 1rem;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .weekday {
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
            padding: 0.5rem;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            background: var(--white);
        }

        .calendar-day.empty {
            border: none;
            cursor: default;
        }

        .calendar-day:not(.empty):hover {
            border-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: var(--box-shadow);
        }

        .calendar-day.today {
            border-color: var(--accent-color);
            background: rgba(0, 168, 204, 0.1);
        }

        .calendar-day.selected {
            background: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }

        .calendar-day.has-appointments {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--success-color);
        }

        .day-number {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .appointment-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--success-color);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .calendar-legend {
            display: flex;
            gap: 1.5rem;
            padding: 1rem;
            border-top: 1px solid var(--gray-200);
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid var(--gray-300);
        }

        .legend-color.available {
            background: var(--white);
        }

        .legend-color.has-appointments {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--success-color);
        }

        .legend-color.selected {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .calendar-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .current-month {
            font-weight: 600;
            color: var(--dark-color);
            text-transform: capitalize;
            min-width: 200px;
            text-align: center;
        }

        .btn-icon {
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            color: var(--gray-600);
            padding: 0.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }

        .appointments-list {
            max-height: 600px;
            overflow-y: auto;
            padding: 1rem;
        }

        .appointment-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: var(--transition);
            background: var(--white);
        }

        .appointment-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow);
            transform: translateX(5px);
        }

        .appointment-card.programada {
            border-left: 4px solid var(--warning-color);
        }

        .appointment-card.completada {
            border-left: 4px solid var(--success-color);
            opacity: 0.7;
        }

        .appointment-card.cancelada {
            border-left: 4px solid var(--danger-color);
            opacity: 0.6;
        }

        .appointment-time {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            min-width: 80px;
            padding: 0.5rem;
            background: var(--gray-100);
            border-radius: var(--border-radius);
        }

        .appointment-time i {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .appointment-time span {
            font-weight: 600;
            color: var(--dark-color);
        }

        .appointment-info {
            flex: 1;
        }

        .appointment-info h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }

        .appointment-info p {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .appointment-status {
            display: flex;
            align-items: center;
        }

        .appointment-detail-card {
            display: grid;
            gap: 1rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: var(--border-radius);
        }

        .detail-row.full-width {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .detail-row label {
            font-weight: 600;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-row span {
            color: var(--gray-600);
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
        }

        .filter-controls select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            background: var(--white);
            cursor: pointer;
        }

        @media (max-width: 1024px) {
            .appointments-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .calendar-days {
                gap: 0.25rem;
            }

            .calendar-day {
                padding: 0.25rem;
            }

            .day-number {
                font-size: 0.9rem;
            }

            .appointment-count {
                width: 16px;
                height: 16px;
                font-size: 0.65rem;
            }

            .appointment-card {
                flex-direction: column;
                align-items: flex-start;
            }

            .appointment-time {
                width: 100%;
                flex-direction: row;
                justify-content: center;
            }
        }
    </style>
</body>
</html>
